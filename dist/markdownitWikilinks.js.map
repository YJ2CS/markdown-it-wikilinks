{"version":3,"file":"markdownItWikiLinks.modern.js","sources":["../index.cjs"],"sourcesContent":["\nimport createPlugin from '@gerhobbelt/markdown-it-regexp';\nimport sanitize from 'sanitize-filename';\n\n\n\nfunction removeInitialSlashes(str) {\n  return str.replace(/^\\/+/g, '');\n}\n\n// separate the setup/config object from the `md.use(...)` call for code clarity:\nconst defaultSetup = {\n  pluginId: 'wikilink',\n  replacer: function wikilinksReplacer(match, setup, options, env, tokens, id) {\n    let label = '';\n    let pageName = '';\n    let href = '';\n    let htmlAttrs = [];\n    const isSplit = !!match[2];\n\n    function isAbsolute(pageName) {\n      return options.makeAllLinksAbsolute || pageName.charCodeAt(0) === 0x2F;/* / */\n    }\n\n    if (isSplit) {\n      label = match[3];\n      pageName = match[1];\n    } else {\n      label = match[1];\n      pageName = options.generatePageNameFromLabel(label);\n    }\n    let originalLabel = label;\n    let originalPageName = pageName;\n    label = options.postProcessLabel(label);\n    pageName = options.postProcessPageName(pageName);\n\n    // make sure none of the values are empty\n    if (!label || !pageName) {\n      return match.input;\n    }\n\n    if (isAbsolute(pageName)) {\n      pageName = removeInitialSlashes(pageName);\n      href = options.baseURL + pageName + options.uriSuffix;\n    } else {\n      href = options.relativeBaseURL + pageName + options.uriSuffix;\n    }\n    href = setup.escape(href);\n\n    htmlAttrs.push(`href=\"${href}\"`);\n    for (let attrName in options.htmlAttributes) {\n      const attrValue = options.htmlAttributes[attrName];\n      htmlAttrs.push(`${attrName}=\"${setup.encodeHtmlAttr(attrValue)}\"`);\n    }\n\n    return this.renderLink({\n      pageName,\n      label,\n      originalPageName,\n      originalLabel,\n      href,\n      htmlAttrs\n    }, setup, options, env, tokens, id);\n\n    // - showcase using the `options` passed in via `MarkdownIt.use()`\n    // - showcase using the `setup` object\n    // - showcase using the `tokens` stream + `id` index to access the token\n    // return '\\n' + setup.pluginId + ':' + options.opt1 + ':' + setup.escape(url) + ':' + options.opt2 + ':' + (token.wonko || '---') + ':' + token.type + ':' + token.nesting + ':' + token.level;\n  },\n  renderLink: function wikilinksRenderLink(info, setup, options, env, tokens, id) {\n    let htmlAttrsString = info.htmlAttrs.join(' ');\n\n    return `<a ${htmlAttrsString}>${info.label}</a>`;\n  },\n  setup: function wikilinksSetup(config, options) {\n    const defaults = {\n      linkPattern: /\\[\\[([^\\x00-\\x1f|]+?)(\\|([\\s\\S]+?))?\\]\\]/,          // accept anything, except control characters (CR, LF, etc) or |\n      // linkPattern: /\\[\\[([-\\w\\s\\/]+)(\\|([-\\w\\s\\/]+))?\\]\\]/,          // accept words, dashes and whitespace\n\n      baseURL: '/',\n      relativeBaseURL: './',\n      makeAllLinksAbsolute: false,\n      uriSuffix: '.html',\n      htmlAttributes: {\n      },\n      generatePageNameFromLabel: (label) => {\n        return label;\n      },\n      postProcessPageName: (pageName) => {\n        pageName = pageName.trim();\n        pageName = pageName.split('/').map(sanitize).join('/');\n        pageName = pageName.replace(/\\s+/g, '_');\n        return pageName;\n      },\n      postProcessLabel: (label) => {\n        label = label.trim();\n        return label;\n      }\n    };\n\n    options = Object.assign({}, defaults, options);\n\n    // override the regexp used for token matching:\n    if (options.linkPattern) {\n      config.regexp = options.linkPattern;\n    }\n\n    return options;\n  }\n};\n\nconst plugin = createPlugin(\n  // regexp to match: fake one. Will be set up by setup callback instead.\n  /./,\n\n  Object.assign({}, defaultSetup)\n);\n\n// only use this for test rigs:\nplugin.createTestInstance = function (setup) {\n  createPlugin.reset();\n  let setupObj = null;\n  if (setup) {\n    // allow user-provided setup to 'postprocess' the default setup:\n    setupObj = {\n      setup: function customSetup(config, options) {\n        options = this.originalSetup(config, options);\n        options = this.userSetup(config, options);\n        return options;\n      },\n      originalSetup: defaultSetup.setup,\n      userSetup: setup\n    };\n  }\n  const p = createPlugin(\n    // regexp to match: fake one. Will be set up by setup callback instead.\n    /./,\n\n    Object.assign({}, defaultSetup, setupObj)\n  );\n  return p;\n};\n\n\nexport default plugin;\n"],"names":["removeInitialSlashes","str","replace","defaultSetup","pluginId","replacer","wikilinksReplacer","match","setup","options","env","tokens","id","label","pageName","href","htmlAttrs","isSplit","isAbsolute","makeAllLinksAbsolute","charCodeAt","generatePageNameFromLabel","originalLabel","originalPageName","postProcessLabel","postProcessPageName","input","baseURL","uriSuffix","relativeBaseURL","escape","push","attrName","htmlAttributes","attrValue","encodeHtmlAttr","renderLink","wikilinksRenderLink","info","htmlAttrsString","join","wikilinksSetup","config","defaults","linkPattern","trim","split","map","sanitize","Object","assign","regexp","plugin","createPlugin","createTestInstance","reset","setupObj","customSetup","originalSetup","userSetup","p"],"mappings":"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"}
